<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consensus Philosophique - Système Distribué</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #f5f5f0;
            color: #2c2c2c;
            min-height: 100vh;
            padding: 20px;
        }

        .dashboard {
            max-width: 1600px;
            margin: 0 auto;
        }

        .header {
background: #633e11;
background: linear-gradient(90deg, rgb(73, 47, 14) 0%, rgba(128, 88, 36, 0.63) 100%);            
padding: 30px;
            border-radius: 8px;
            margin-bottom: 30px;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.04);
            border: 1px solid #e8e8e8;
        }

        .header h1 {
            font-size: 32px;
            margin-bottom: 10px;
            color: #2c2c2c;
            font-weight: 300;
            letter-spacing: -0.5px;
        }

        .header p {
            color: #707070;
            font-size: 14px;
            font-weight: 400;
        }

        .status-bar {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .status-item {
            background: #faf9f5;
            padding: 12px 20px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            gap: 10px;
            border: 1px solid #e8e6e0;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .status-dot.online { 
            background: #8b7355;
        }
        .status-dot.offline { 
            background: #b0b0b0;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: #ffffff;
            border: 1px solid #e8e8e8;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.04);
        }

        .stat-card h3 {
            font-size: 11px;
            text-transform: uppercase;
            color: #909090;
            margin-bottom: 10px;
            letter-spacing: 1px;
            font-weight: 500;
        }

        .stat-value {
            font-size: 36px;
            font-weight: 300;
            color: #2c2c2c;
        }

        .network-topology {
            background: #ffffff;
            border: 1px solid #e8e8e8;
            border-radius: 8px;
            padding: 30px;
            margin-bottom: 30px;
            min-height: 550px;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.04);
        }

        .network-topology h2 {
            margin-bottom: 20px;
            color: #2c2c2c;
            font-weight: 400;
            font-size: 18px;
        }

        .topology-canvas {
            position: relative;
            width: 100%;
            height: 500px;
            background: #faf9f5;
            border-radius: 6px;
            border: 1px solid #e8e6e0;
        }

        .node {
            position: absolute;
            width: 130px;
            padding: 15px;
            background: #ffffff;
            border: 1px solid #d0d0d0;
            border-radius: 6px;
            text-align: center;
            transition: all 0.3s;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.04);
        }

        .node.connected {
            border-color: #a89176;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.06);
        }

        .node.disconnected {
            border-color: #e0e0e0;
            opacity: 0.4;
        }

        .node.winner {
            border-color: #8b7355;
            background: #faf9f5;
            box-shadow: 0 2px 4px rgba(139, 115, 85, 0.15);
        }

        .node-name {
            font-weight: 500;
            margin-bottom: 5px;
            font-size: 13px;
            color: #2c2c2c;
        }

        .node-port {
            font-size: 11px;
            color: #909090;
        }

        .node-latency {
            font-size: 12px;
            margin-top: 5px;
            color: #707070;
        }

        .node-wins {
            margin-top: 8px;
            padding: 5px;
            background: #f8f8f8;
            border-radius: 4px;
            font-weight: 500;
            color: #2c2c2c;
            font-size: 12px;
            border: 1px solid #e8e8e8;
        }

        .winner-badge {
            position: absolute;
            top: -10px;
            right: -10px;
            background: #8b7355;
            color: #ffffff;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: 600;
            box-shadow: 0 2px 4px rgba(139, 115, 85, 0.25);
        }

        .coordinator {
            width: 150px;
            background: #faf9f5;
            border-color: #a89176;
        }

        svg.connections {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .connection-line {
            stroke: #e0e0e0;
            stroke-width: 1.5;
            fill: none;
        }

        .connection-line.active {
            stroke: #a89176;
            stroke-width: 2;
        }

        .connection-line.winner-line {
            stroke: #8b7355;
            stroke-width: 2;
        }

        .winner-history {
            background: #ffffff;
            border: 1px solid #e8e8e8;
            border-radius: 8px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.04);
        }

        .winner-history h2 {
            margin-bottom: 20px;
            color: #2c2c2c;
            font-weight: 400;
            font-size: 18px;
        }

        .winner-timeline {
            display: flex;
            gap: 15px;
            overflow-x: auto;
            padding: 10px 0;
        }

        .winner-item {
            min-width: 200px;
            background: #f8f8f8;
            border: 1px solid #e8e8e8;
            border-radius: 6px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.04);
        }

        .winner-item.recent {
            border-color: #8b7355;
            background: #faf9f5;
            box-shadow: 0 1px 3px rgba(139, 115, 85, 0.12);
        }

        .winner-item-name {
            font-weight: 500;
            font-size: 16px;
            margin-bottom: 5px;
            color: #2c2c2c;
        }

        .winner-item-score {
            color: #707070;
            font-size: 20px;
            font-weight: 300;
            margin: 5px 0;
        }

        .winner-item.recent .winner-item-score {
            color: #8b7355;
        }

        .winner-item-time {
            font-size: 11px;
            color: #909090;
        }

        .node-metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .node-metric-card {
            background: #ffffff;
            border: 1px solid #e8e8e8;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.04);
        }

        .node-metric-card.connected {
            border-left: 3px solid #a89176;
        }

        .node-metric-card.disconnected {
            border-left: 3px solid #e0e0e0;
            opacity: 0.5;
        }

        .node-metric-card.top-winner {
            border: 2px solid #8b7355;
            background: #faf9f5;
            box-shadow: 0 1px 3px rgba(139, 115, 85, 0.12);
        }

        .node-metric-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .node-metric-name {
            font-weight: 500;
            font-size: 16px;
            color: #2c2c2c;
        }

        .node-status-badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
        }

        .node-status-badge.connected {
            background: #f8f8f8;
            color: #2c2c2c;
            border: 1px solid #d0d0d0;
        }

        .node-status-badge.disconnected {
            background: #fafafa;
            color: #909090;
            border: 1px solid #e0e0e0;
        }

        .metric-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #f8f8f8;
        }

        .metric-label {
            font-size: 13px;
            color: #707070;
        }

        .metric-value {
            font-weight: 500;
            color: #2c2c2c;
        }

        .message-log {
            background: #ffffff;
            border: 1px solid #e8e8e8;
            border-radius: 8px;
            padding: 25px;
            margin-bottom: 30px;
            max-height: 400px;
            overflow-y: auto;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.04);
        }

        .message-log h2 {
            margin-bottom: 15px;
            color: #2c2c2c;
            font-weight: 400;
            font-size: 18px;
        }

        .message-entry {
            padding: 10px;
            margin-bottom: 8px;
            background: #f8f8f8;
            border-left: 2px solid #d0d0d0;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }

        .message-entry.REQUEST { border-left-color: #707070; }
        .message-entry.TCP_SEND { border-left-color: #8b7355; }
        .message-entry.TCP_RECV { border-left-color: #a89176; }
        .message-entry.CONSENSUS_START { border-left-color: #9a8269; }
        .message-entry.CONSENSUS_END { border-left-color: #7a6550; }
        .message-entry.RESPONSE { 
            border-left-color: #8b7355; 
            background: #faf9f5;
            font-weight: 500;
        }

        .message-time {
            color: #909090;
            margin-right: 10px;
        }

        .message-type {
            color: #707070;
            font-weight: 500;
            margin-right: 10px;
        }

        .btn {
            padding: 10px 20px;
            border: 1px solid #d0d0d0;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
            background: #ffffff;
            color: #2c2c2c;
            margin-right: 10px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            font-size: 14px;
        }

        .btn:hover {
            background: #faf9f5;
            border-color: #a89176;
        }

        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }

        ::-webkit-scrollbar-track {
            background: #fafafa;
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb {
            background: #d0d0d0;
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #b0b0b0;
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <div class="header">
            <h1 style="color: #e0e0e0;">Consensus Philosophique</h1>
            <p style="color: #e0e0e0;">Système Distribué - Visualisation TCP et Communication Inter-Nœuds</p>
            
            <div class="status-bar">
                <div class="status-item">
                    <div class="status-dot online" id="systemStatus"></div>
                    <span id="statusText">Vérification...</span>
                </div>
                <div class="status-item">
                    <span>Nœuds actifs: <strong id="activeNodes">0/6</strong></span>
                </div>
                <div class="status-item">
                    <span>Sessions: <strong id="totalSessions">0</strong></span>
                </div>
                <div class="status-item">
                    <span>Messages TCP: <strong id="totalMessages">0</strong></span>
                </div>
            </div>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <h3>Taux de succès</h3>
                <div class="stat-value" id="successRate">0%</div>
            </div>
            <div class="stat-card">
                <h3>Temps moyen</h3>
                <div class="stat-value" id="avgTime">0s</div>
            </div>
            <div class="stat-card">
                <h3>Consensus réussis</h3>
                <div class="stat-value" id="successfulConsensus">0</div>
            </div>
        </div>

        <div class="network-topology">
            <h2>Topologie Réseau - Gagnant Récent en Or</h2>
            <div class="topology-canvas" id="topologyCanvas">
                <svg class="connections" id="connectionsSvg"></svg>
            </div>
        </div>

        <div class="winner-history">
            <h2>Historique des Gagnants (10 plus récents)</h2>
            <div class="winner-timeline" id="winnerTimeline">
                <p style="opacity: 0.5;">Chargement...</p>
            </div>
        </div>

        <div style="margin-bottom: 30px;">
            <h2 style="margin-bottom: 20px; padding: 0 10px; color: #2c2c2c; font-weight: 400; font-size: 18px;">Métriques par Nœud</h2>
            <div class="node-metrics-grid" id="nodeMetricsGrid"></div>
        </div>

        <div class="message-log">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <h2>Journal TCP</h2>
                <button class="btn" onclick="clearMessageLog()">Effacer</button>
            </div>
            <div id="messageLogContent"></div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://127.0.0.1:8000';
        
        let nodeMetrics = {};
        let messageLog = [];
        let globalMetrics = {};
        let recommendations = [];
        let nodeWins = {1: 0, 2: 0, 3: 0, 4: 0, 5: 0, 6: 0};
        let currentWinner = null;
        let winnerHistory = [];

        const nodePositions = {
            coordinator: { x: 50, y: 50 },
            1: { x: 20, y: 35 },
            2: { x: 45, y: 20 },
            3: { x: 75, y: 20 },
            4: { x: 20, y: 65 },
            5: { x: 45, y: 80 },
            6: { x: 75, y: 65 }
        };

        const philosophers = {
            1: { name: "Aristotle", school: "Éthique des vertus" },
            2: { name: "Immanuel Kant", school: "Déontologie" },
            3: { name: "Friedrich Nietzsche", school: "Pouvoir" },
            4: { name: "Fyodor Dostoevsky", school: "Existentialisme" },
            5: { name: "Leo Tolstoy", school: "Anarchisme" },
            6: { name: "Confucius", school: "Éthique sociale" }
        };

        const philosopherNameToId = {
            "Aristotle": 1,
            "Immanuel Kant": 2,
            "Friedrich Nietzsche": 3,
            "Fyodor Dostoevsky": 4,
            "Leo Tolstoy": 5,
            "Confucius": 6
        };

        async function init() {
            console.log('Démarrage du dashboard...');
            renderTopology();
            await fetchAllMetrics();
            setInterval(fetchAllMetrics, 2000);
        }

        async function fetchAllMetrics() {
            try {
                const nodeResponse = await fetch(`${API_BASE}/metrics/nodes`);
                const nodeData = await nodeResponse.json();
                nodeMetrics = nodeData.nodes;

                const msgResponse = await fetch(`${API_BASE}/metrics/messages?limit=30`);
                const msgData = await msgResponse.json();
                messageLog = msgData.messages;

                const globalResponse = await fetch(`${API_BASE}/metrics/global`);
                globalMetrics = await globalResponse.json();

                const recResponse = await fetch(`${API_BASE}/recommendations?limit=50`);
                const recData = await recResponse.json();
                recommendations = recData.recommendations;

                calculateWinners();
                updateUI();
                updateTopology();
                updateNodeMetrics();
                updateMessageLog();
                updateWinnerHistory();
                
            } catch (error) {
                console.error('Erreur:', error);
                document.getElementById('systemStatus').className = 'status-dot offline';
                document.getElementById('statusText').textContent = 'Système hors ligne';
            }
        }

        function calculateWinners() {
            nodeWins = {1: 0, 2: 0, 3: 0, 4: 0, 5: 0, 6: 0};
            winnerHistory = [];

            const sortedRecs = [...recommendations].sort((a, b) => b.timestamp - a.timestamp);

            sortedRecs.forEach(rec => {
                if (rec.winner && rec.winner.supporters && rec.winner.supporters.length > 0) {
                    const winnerName = rec.winner.supporters[0].philosopher;
                    const winnerId = philosopherNameToId[winnerName];
                    
                    if (winnerId) {
                        nodeWins[winnerId]++;
                        winnerHistory.push({
                            id: winnerId,
                            name: winnerName,
                            score: rec.winner.average_score,
                            timestamp: rec.timestamp
                        });
                    }
                }
            });

            if (winnerHistory.length > 0) {
                currentWinner = winnerHistory[0].id;
                console.log('Gagnant RÉCENT (dernier):', winnerHistory[0].name, 'ID:', currentWinner);
            }
        }

        function updateUI() {
            document.getElementById('systemStatus').className = 'status-dot online';
            document.getElementById('statusText').textContent = 'Système en ligne';
            
            const activeCount = Object.values(nodeMetrics).filter(n => n.connection_status === 'connected').length;
            document.getElementById('activeNodes').textContent = `${activeCount}/6`;
            document.getElementById('totalSessions').textContent = globalMetrics.total_consensus_sessions || 0;
            document.getElementById('totalMessages').textContent = messageLog.length;

            document.getElementById('successRate').textContent = (globalMetrics.success_rate || 0) + '%';
            document.getElementById('avgTime').textContent = (globalMetrics.avg_processing_time || 0) + 's';
            document.getElementById('successfulConsensus').textContent = globalMetrics.successful_consensus || 0;
        }

        function renderTopology() {
            const canvas = document.getElementById('topologyCanvas');
            canvas.innerHTML = '<svg class="connections" id="connectionsSvg"></svg>';

            const coordDiv = document.createElement('div');
            coordDiv.className = 'node coordinator';
            coordDiv.style.left = `${nodePositions.coordinator.x}%`;
            coordDiv.style.top = `${nodePositions.coordinator.y}%`;
            coordDiv.style.transform = 'translate(-50%, -50%)';
            coordDiv.innerHTML = `
                <div class="node-name">COORDINATEUR</div>
                <div class="node-port">Port 8000</div>
            `;
            canvas.appendChild(coordDiv);

            for (let id = 1; id <= 6; id++) {
                const phil = philosophers[id];
                const nodeDiv = document.createElement('div');
                nodeDiv.className = 'node disconnected';
                nodeDiv.id = `node-${id}`;
                nodeDiv.style.left = `${nodePositions[id].x}%`;
                nodeDiv.style.top = `${nodePositions[id].y}%`;
                nodeDiv.style.transform = 'translate(-50%, -50%)';
                nodeDiv.innerHTML = `
                    <div class="node-name">${phil.name}</div>
                    <div class="node-port">Port 500${id}</div>
                    <div class="node-latency" id="latency-${id}">--ms</div>
                    <div class="node-wins" id="wins-${id}">0 victoires</div>
                `;
                canvas.appendChild(nodeDiv);

                const svg = document.getElementById('connectionsSvg');
                const svgNS = "http://www.w3.org/2000/svg";
                const line = document.createElementNS(svgNS, "line");
                line.setAttribute("x1", `${nodePositions.coordinator.x}%`);
                line.setAttribute("y1", `${nodePositions.coordinator.y}%`);
                line.setAttribute("x2", `${nodePositions[id].x}%`);
                line.setAttribute("y2", `${nodePositions[id].y}%`);
                line.setAttribute("class", "connection-line");
                line.setAttribute("id", `line-${id}`);
                line.setAttribute("stroke-dasharray", "5,5");
                svg.appendChild(line);
            }
        }

        function updateTopology() {
            for (let id = 1; id <= 6; id++) {
                const node = document.getElementById(`node-${id}`);
                const line = document.getElementById(`line-${id}`);
                const latencyEl = document.getElementById(`latency-${id}`);
                const winsEl = document.getElementById(`wins-${id}`);
                
                if (nodeMetrics[id]) {
                    const metrics = nodeMetrics[id];
                    const isConnected = metrics.connection_status === 'connected';
                    const isWinner = currentWinner === id;
                    
                    node.className = isConnected ? 'node connected' : 'node disconnected';
                    
                    if (isWinner) {
                        node.classList.add('winner');
                        line.classList.add('winner-line');
                        
                        if (!node.querySelector('.winner-badge')) {
                            const badge = document.createElement('div');
                            badge.className = 'winner-badge';
                            badge.textContent = 'RÉCENT';
                            node.appendChild(badge);
                        }
                    } else {
                        node.classList.remove('winner');
                        line.classList.remove('winner-line');
                        const badge = node.querySelector('.winner-badge');
                        if (badge) badge.remove();
                    }
                    
                    if (metrics.last_response_time > 0) {
                        latencyEl.textContent = `${Math.round(metrics.last_response_time * 1000)}ms`;
                    }
                    
                    const wins = nodeWins[id] || 0;
                    winsEl.textContent = `${wins} victoire${wins !== 1 ? 's' : ''}`;
                    
                    if (isConnected && line) {
                        line.classList.add('active');
                        setTimeout(() => line.classList.remove('active'), 1000);
                    }
                }
            }
        }

        function updateWinnerHistory() {
            const timeline = document.getElementById('winnerTimeline');
            
            if (winnerHistory.length === 0) {
                timeline.innerHTML = '<p style="opacity: 0.5;">Aucun combat...</p>';
                return;
            }

            const last10 = winnerHistory.slice(0, 10);
            
            timeline.innerHTML = last10.map((winner, index) => {
                const time = new Date(winner.timestamp).toLocaleTimeString('fr-FR');
                
                return `
                    <div class="winner-item ${index === 0 ? 'recent' : ''}">
                        <div class="winner-item-name">${winner.name}</div>
                        <div class="winner-item-score">${winner.score}/10</div>
                        <div class="winner-item-time">${time}</div>
                        ${index === 0 ? '<div style="margin-top: 5px; color: #8b7355; font-weight: 500;">DERNIER</div>' : ''}
                    </div>
                `;
            }).join('');
        }

        function updateNodeMetrics() {
            const grid = document.getElementById('nodeMetricsGrid');
            grid.innerHTML = '';

            const topWinnerId = Object.keys(nodeWins).reduce((a, b) => 
                nodeWins[a] > nodeWins[b] ? a : b
            );

            for (let id = 1; id <= 6; id++) {
                if (nodeMetrics[id]) {
                    const metrics = nodeMetrics[id];
                    const isConnected = metrics.connection_status === 'connected';
                    const wins = nodeWins[id] || 0;
                    const isTopWinner = id == topWinnerId && wins > 0;
                    
                    const card = document.createElement('div');
                    card.className = `node-metric-card ${isConnected ? 'connected' : 'disconnected'} ${isTopWinner ? 'top-winner' : ''}`;
                    
                    card.innerHTML = `
                        <div class="node-metric-header">
                            <div class="node-metric-name">
                                ${metrics.name}
                                ${isTopWinner ? ' [MEILLEUR]' : ''}
                            </div>
                            <div class="node-status-badge ${isConnected ? 'connected' : 'disconnected'}">
                                ${isConnected ? 'CONNECTÉ' : 'DÉCONNECTÉ'}
                            </div>
                        </div>
                        
                        <div class="metric-row" style="background: #faf9f5; margin-bottom: 10px; padding: 10px; border-radius: 6px; border: 1px solid #e8e6e0;">
                            <span class="metric-label" style="font-weight: 500; color: #2c2c2c;">VICTOIRES:</span>
                            <span class="metric-value" style="font-size: 20px; color: #8b7355;">${wins}</span>
                        </div>
                        
                        <div class="metric-row">
                            <span class="metric-label">Port TCP:</span>
                            <span class="metric-value">${metrics.port}</span>
                        </div>
                        
                        <div class="metric-row">
                            <span class="metric-label">Requêtes:</span>
                            <span class="metric-value">${metrics.total_requests}</span>
                        </div>
                        
                        <div class="metric-row">
                            <span class="metric-label">Succès:</span>
                            <span class="metric-value">${metrics.success_rate}%</span>
                        </div>
                        
                        <div class="metric-row">
                            <span class="metric-label">Temps moy:</span>
                            <span class="metric-value">${(metrics.avg_response_time * 1000).toFixed(0)}ms</span>
                        </div>
                        
                        <div class="metric-row">
                            <span class="metric-label">Accept:</span>
                            <span class="metric-value">${metrics.votes_accept}</span>
                        </div>
                        
                        <div class="metric-row">
                            <span class="metric-label">Reject:</span>
                            <span class="metric-value" style="color: #909090">${metrics.votes_reject}</span>
                        </div>
                    `;
                    
                    grid.appendChild(card);
                }
            }
        }

        function updateMessageLog() {
            const logContent = document.getElementById('messageLogContent');
            
            if (messageLog.length === 0) {
                logContent.innerHTML = '<p style="text-align: center; opacity: 0.5;">Aucun message...</p>';
                return;
            }

            logContent.innerHTML = messageLog.map(msg => {
                const time = new Date(msg.timestamp * 1000).toLocaleTimeString('fr-FR');
                return `
                    <div class="message-entry ${msg.type}">
                        <span class="message-time">[${time}]</span>
                        <span class="message-type">${msg.type}</span>
                        <span>${msg.source} → ${msg.target}: ${msg.content}</span>
                    </div>
                `;
            }).join('');
        }

        function clearMessageLog() {
            messageLog = [];
            updateMessageLog();
        }

        init();
    </script>
</body>
</html>